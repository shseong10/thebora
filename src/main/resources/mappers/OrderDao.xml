<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.icia.guree.dao.OrderDao">
    <resultMap id="orderResult" type="OrderDto">
        <result property="order_num" column="order_num" />
        <result property="item_num" column="item_num" />
        <result property="order_id" column="order_id" />
        <result property="order_count" column="order_count" />
        <result property="item_price" column="item_price" />
        <result property="order_date" column="order_date" />
        <result property="order_status" column="order_status" />
    </resultMap>
    <insert id="buyNewItem" parameterType="OrderDto" useGeneratedKeys="true" keyProperty="order_num">
        insert into hotdealorder (item_num, order_id, order_count, item_price, order_date, order_status)
        values (#{item_num}, #{order_id}, #{order_count}, #{item_price}, default, 1)
        <selectKey keyProperty="order_num" resultType="Integer" order="AFTER">
            select last_insert_id()
        </selectKey>
    </insert>

    <update id="addPoint">
        update member set m_point = m_point + #{total_amount}, m_sumpoint = m_sumpoint + #{total_amount} where m_id = #{order_id}
    </update>
</mapper>